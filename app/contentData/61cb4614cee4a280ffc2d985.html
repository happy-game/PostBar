<div class="markdown-text"><p><img src="https://user-images.githubusercontent.com/23253540/147585620-ee5b49e3-c947-4fce-a4c2-560a6578248e.png" alt="image"></p>
<p>åŸæ–‡é“¾æ¥: <a href="https://github.com/xiaoxiaojx/blog/issues/24">https://github.com/xiaoxiaojx/blog/issues/24</a></p>
<h2>èƒŒæ™¯</h2>
<p>æ”¶åˆ°å‘Šè­¦é€šçŸ¥, âš ï¸ å®¹å™¨çº¿ç¨‹æ•°å¼‚å¸¸ï¼ˆPIDä¸Šé™ä¸º15Kï¼Œè¶…è¿‡15Kåˆ™æ— æ³•æ–°å»ºè¿›ç¨‹ï¼‰âš ï¸ ã€‚è¯¥æœåŠ¡ä¼šå®šæ—¶é€šè¿‡ puppeteer è¿›è¡Œä¸€äº›é¡µé¢æ€§èƒ½æ”¶é›†çš„ä»»åŠ¡ï¼Œä¸ºä»€ä¹ˆæ®‹ç•™äº†è¿™ä¹ˆå¤šè¿›ç¨‹æ²¡æœ‰æ­£å¸¸é€€å‡ºï¼Ÿ</p>
<p>è¿›å…¥ç»ˆç«¯è°ƒè¯•åï¼Œå‘ç°äº†å¤§é‡çš„ chrome defunct processes ğŸ§Ÿâ€â™€ï¸ğŸ§Ÿâ€â™‚ï¸ åƒµå°¸è¿›ç¨‹ã€‚äºæ˜¯å°è¯•åœ¨ puppeteer issue <a href="https://github.com/puppeteer/puppeteer/issues/1825">Zombie Process problem. #1825</a> ä¸­æ‰¾ä¸€æ‰¾ç­”æ¡ˆã€‚</p>
<p><img src="https://user-images.githubusercontent.com/23253540/147537580-776565a9-208a-4508-8554-95287ebb058a.png" alt="451a52f0f90eeeb19449b8dfa8bb92c20651f5b4"></p>
<h2>å°è¯•è§£å†³</h2>
<p>æŒ‰ç…§ puppeteer issue ä¸­çš„å»ºè®®ï¼Œåœ¨ browser.close() åï¼Œæ–°å¢äº† ps.kill å»æ€æ­»å¯èƒ½ä¼šæ®‹ç•™çš„ç›¸å…³è¿›ç¨‹ã€‚</p>
<pre class="prettyprint language-js"><code>await page.close();
await browser.close();
const psLookup = await ps.lookup({ pid: borwserPID });

for (let proc of psLookup) {
  if (_.has(proc, &#x27;pid&#x27;)) {
      await ps.kill(proc.pid, &#x27;SIGKILL&#x27;);
  }
}
</code></pre><p>ç„¶ååˆè¿‡äº†å‡ å¤©ï¼Œåˆæ”¶åˆ°äº†å‘Šè­¦é€šçŸ¥ï¼Œå³æœ¬æ¬¡å¹¶æœªè§£å†³è¯¥é—®é¢˜ã€‚æœ€ååˆé€šè¿‡è¿è¡Œ puppeteer æ—¶åŠ ä¸Š --single-process å‚æ•°å’Œå®šæ—¶è°ƒç”¨ kill -9 [pid] å»æ€æ­»åƒµå°¸è¿›ç¨‹ç­‰æ–¹æ³•éƒ½ä»¥å¤±è´¥å‘Šç»ˆ âŒ ã€‚</p>
<pre class="prettyprint language-js"><code>const chromeFlags = [
    &#x27;--headless&#x27;,
    &#x27;--no-sandbox&#x27;,
    &quot;--disable-gpu&quot;,
    &quot;--single-process&quot;,
    &quot;--no-zygote&quot;
]
</code></pre><h2>åƒµå°¸è¿›ç¨‹</h2>
<p>æ­£å½“å¤§å®¶å›°æƒ‘çš„æ—¶å€™ï¼ŒåŒå­¦ a å‘æ¥äº†ä¸€ç¯‡æ–‡ç«  <a href="https://mp.weixin.qq.com/s/85ZigYHVBtu6LDTtqpesVw">ä¸€æ¬¡ Docker å®¹å™¨å†…å¤§é‡åƒµå°¸è¿›ç¨‹æ’æŸ¥åˆ†æ</a>ï¼Œæ–‡ç« ä¸­è¿›è¡Œäº†è¯¦ç»†çš„ç§‘æ™®ï¼Œæ­¤æ—¶æ‰çœŸæ­£è®¤è¯†äº†åƒµå°¸è¿›ç¨‹ã€‚</p>
<p>åˆ°è¿™é‡Œç»™æˆ‘çš„ä½“ä¼šæ˜¯ï¼Œå¦‚æœé‡è§äº†ä¸€ç­¹è«å±•çš„é—®é¢˜ï¼Œä¸å¦¨å…ˆä»”ç»†äº†è§£ä¸€ä¸‹è¯¥é—®é¢˜çš„<strong><em>å®šä¹‰ä¸ä»‹ç»</em></strong>ã€‚å®ƒçš„åŸºç¡€æ¦‚å¿µæ˜¯ä»€ä¹ˆï¼Ÿé€ æˆçš„æœ¬è´¨åŸå› æ˜¯ä»€ä¹ˆï¼Ÿ<strong><em>äº†è§£å®Œå‰å› åæœåæˆ–è®¸èƒ½å¤Ÿäº‹åŠåŠŸå€</em></strong>ã€‚</p>
<blockquote>
<p>åƒµå°¸è¿›ç¨‹ - ç»´åŸºç™¾ç§‘: åœ¨ç±»UNIXç³»ç»Ÿä¸­ï¼Œåƒµå°¸è¿›ç¨‹æ˜¯æŒ‡å®Œæˆæ‰§è¡Œï¼ˆé€šè¿‡exitç³»ç»Ÿè°ƒç”¨ï¼Œæˆ–è¿è¡Œæ—¶å‘ç”Ÿè‡´å‘½é”™è¯¯æˆ–æ”¶åˆ°ç»ˆæ­¢ä¿¡å·æ‰€è‡´ï¼‰ï¼Œä½†åœ¨æ“ä½œç³»ç»Ÿçš„è¿›ç¨‹è¡¨ä¸­ä»ç„¶å­˜åœ¨å…¶è¿›ç¨‹æ§åˆ¶å—ï¼Œå¤„äº&quot;ç»ˆæ­¢çŠ¶æ€&quot;çš„è¿›ç¨‹ã€‚è¿™å‘ç”Ÿäºå­è¿›ç¨‹éœ€è¦ä¿ç•™è¡¨é¡¹ä»¥å…è®¸å…¶çˆ¶è¿›ç¨‹è¯»å–å­è¿›ç¨‹çš„é€€å‡ºçŠ¶æ€ï¼šä¸€æ—¦é€€å‡ºæ€é€šè¿‡waitç³»ç»Ÿè°ƒç”¨è¯»å–ï¼Œåƒµå°¸è¿›ç¨‹æ¡ç›®å°±ä»è¿›ç¨‹è¡¨ä¸­åˆ é™¤ï¼Œç§°ä¹‹ä¸º&quot;å›æ”¶&quot;ï¼ˆreapedï¼‰ã€‚æ­£å¸¸æƒ…å†µä¸‹ï¼Œè¿›ç¨‹ç›´æ¥è¢«å…¶çˆ¶è¿›ç¨‹waitå¹¶ç”±ç³»ç»Ÿå›æ”¶ã€‚è¿›ç¨‹é•¿æ—¶é—´ä¿æŒåƒµå°¸çŠ¶æ€ä¸€èˆ¬æ˜¯é”™è¯¯çš„å¹¶å¯¼è‡´èµ„æºæ³„æ¼ã€‚</p>
</blockquote>
<p>é€šä¿—çš„æ¥è®²ï¼Œå°±åƒä¸‹é¢çš„ç¨‹åºä¸€æ ·ã€‚å½“å­è¿›ç¨‹è°ƒç”¨ exit å‡½æ•°é€€å‡ºäº†ï¼Œä½†æ˜¯çˆ¶è¿›ç¨‹æ²¡æœ‰ç»™å®ƒæ”¶å°¸ï¼Œäºæ˜¯å®ƒå˜æˆäº†æ€ä¸æ­»çš„ğŸ§Ÿâ€â™€ï¸ğŸ§Ÿâ€â™‚ï¸ ï¼Œå› ä¸ºå®ƒæ—©å°±å·²ç»æ­»äº†ï¼Œç°åœ¨åªæ˜¯åœ¨è¿›ç¨‹åˆ—è¡¨ä¸­å äº†ä¸€ä¸ªå‘ä½è€Œå·²ã€‚</p>
<p>å½“è¯¥åƒµå°¸è¿›ç¨‹çš„çˆ¶è¿›ç¨‹é€€å‡ºåï¼Œå®ƒå°±ä¼šè¢«æ‰˜ç®¡åˆ° PID ä¸º 1 çš„è¿›ç¨‹ä¸Šé¢ï¼Œé€šå¸¸ PID ä¸º 1 çš„è¿›ç¨‹ä¼šæ‰®æ¼”æ”¶å°¸çš„è§’è‰²ã€‚
ä½†æ˜¯å½“ Node.js ä¸º PID 1 çš„è¿›ç¨‹æ—¶ï¼Œä¸ä¼šè¿›è¡Œæ”¶å°¸ï¼Œä»è€Œå¯¼è‡´äº†å¤§é‡çš„åƒµå°¸è¿›ç¨‹çš„é—®é¢˜ã€‚</p>
<pre class="prettyprint language-c"><code>#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;unistd.h&gt;

int main() {

  printf(&quot;pid %d\n&quot;, getpid());
  int child_pid = fork();
  if (child_pid == 0) {
    printf(&quot;-----in child process:  %d\n&quot;, getpid());
    exit(0);
  } else {
    sleep(1000000);
  }
  return 0;
}
</code></pre><h2>è§£å†³åŠæ³•</h2>
<p>å½“ Docker ä¸­ç¬¬ä¸€ä¸ªè¿è¡Œçš„ç¨‹åºä¸º node xxx.js æ—¶ Node å°±æˆä¸ºäº† PID ä¸º 1 çš„è¿›ç¨‹ï¼Œæ‰€ä»¥è¯´é—®é¢˜çš„è§£å†³åŠæ³•å¯ä»¥æ˜¯è®©æœ‰èƒ½åŠ›æ”¶å°¸çš„è¿›ç¨‹ä¸ºç¬¬ä¸€ä¸ªè¿è¡Œçš„ç¨‹åºã€‚</p>
<p>åœ¨ <a href="https://github.com/nodejs/docker-node/blob/main/docs/BestPractices.md">Docker and Node.js Best Practices</a> ä¸­å®˜æ–¹ä¹Ÿç»™å‡ºäº†è§£å†³æ–¹æ¡ˆ</p>
<ol>
<li>é€šè¿‡ docker åŠ ä¸Š --init å‚æ•°ä½¿å¾—æœ‰ä¸€ä¸ª init è¿›ç¨‹ä¸º PID ä¸º 1</li>
<li>é€šè¿‡ Tini ä½œä¸ºå®¹å™¨å»è¿è¡Œ Node ç¨‹åº</li>
</ol>
<blockquote>
<p>Node.js was not designed to run as PID 1 which leads to unexpected behaviour when running inside of Docker. For example, a Node.js process running as PID 1 will not respond to SIGINT (CTRL-C) and similar signals. As of Docker 1.13, you can use the --init flag to wrap your Node.js process with a lightweight init system that properly handles running as PID 1.</p>
</blockquote>
<pre class="prettyprint language-bash"><code>docker run -it --init node
</code></pre><blockquote>
<p>You can also include Tini directly in your Dockerfile, ensuring your process is always started with an init wrapper.</p>
</blockquote>
<h2>Tini</h2>
<p>ç°åœ¨è®©æˆ‘ä»¬é€šè¿‡ <a href="https://github.com/krallin/tini">Tini</a> æ¥å­¦ä¹ äº†ä¸€ä¸‹æ”¶å°¸æŠ€æœ¯ï¼Œå¯é€šè¿‡ä¸‹é¢çš„æ–¹å¼è®© Tini å»ä»£ç†è¿è¡Œ Node ç¨‹åºï¼Œä½¿å¾— Node æˆä¸º Tini çš„å­è¿›ç¨‹ã€‚</p>
<pre class="prettyprint language-bash"><code># Add Tini
ENV TINI_VERSION v0.19.0
ADD https:&#x2F;&#x2F;github.com&#x2F;krallin&#x2F;tini&#x2F;releases&#x2F;download&#x2F;${TINI_VERSION}&#x2F;tini &#x2F;tini
RUN chmod +x &#x2F;tini
ENTRYPOINT [&quot;&#x2F;tini&quot;, &quot;--&quot;]

# Run your program under Tini
CMD [&quot;&#x2F;your&#x2F;program&quot;, &quot;-and&quot;, &quot;-its&quot;, &quot;arguments&quot;]
# or docker run your-image &#x2F;your&#x2F;program ...
</code></pre><p>é€šè¿‡ä»”ç»†é˜…è¯» Tini çš„ä»£ç ï¼Œæˆ‘åˆ¤æ–­æ ¸å¿ƒçš„æ”¶å°¸æŠ€æœ¯å°±æ˜¯è¿™ä¸ª <strong><em>waitpid å‡½æ•°</em></strong> äº†ï¼Œå…¶å®åœ¨åƒµå°¸è¿›ç¨‹çš„å®šä¹‰ä¸­å°±æœ‰äº†å¦‚ä½•æ”¶å°¸ï¼Œæ‰€ä»¥å…ˆäº†è§£åŸºç¡€æ¦‚å¿µæ˜¯éå¸¸é‡è¦çš„ã€‚</p>
<pre class="prettyprint language-c"><code>int reap_zombies(const pid_t child_pid, int* const child_exitcode_ptr) {
	pid_t current_pid;
	int current_status;

	while (1) {
		current_pid = waitpid(-1, &amp;current_status, WNOHANG);

		switch (current_pid) {

			case -1:
				if (errno == ECHILD) {
					PRINT_TRACE(&quot;No child to wait&quot;);
					break;
				}
				PRINT_FATAL(&quot;Error while waiting for pids: &#x27;%s&#x27;&quot;, strerror(errno));
				return 1;

			case 0:
				PRINT_TRACE(&quot;No child to reap&quot;);
				break;

			default:
				&#x2F;* A child was reaped. Check whether it&#x27;s the main one. If it is, then
				 * set the exit_code, which will cause us to exit once we&#x27;ve reaped everyone else.
				 *&#x2F;
				PRINT_DEBUG(&quot;Reaped child with pid: &#x27;%i&#x27;&quot;, current_pid);
				if (current_pid == child_pid) {
					&#x2F;&#x2F; ...
				} else if (warn_on_reap &gt; 0) {
					PRINT_WARNING(&quot;Reaped zombie process with pid=%i&quot;, current_pid);
				}

				&#x2F;&#x2F; Check if other childs have been reaped.
				continue;
		}

		&#x2F;* If we make it here, that&#x27;s because we did not continue in the switch case. *&#x2F;
		break;
	}

	return 0;
}
</code></pre><p>å½“ç„¶ Tini ä½œä¸ºçˆ¶è¿›ç¨‹è¿˜æœ‰å…¶ä»–çš„ä¼˜ç‚¹ï¼Œæ¯”å¦‚</p>
<ol>
<li>ä¼šæŠŠæ¥æ”¶åˆ°çš„ä¿¡å·è½¬å‘ç»™å…¶ä»£ç†è¿è¡Œçš„å­è¿›ç¨‹ï¼Œä»£ç å®ç°å¯è§ wait_and_forward_signal å‡½æ•°</li>
<li>ä»£ç†è¿è¡Œçš„å­è¿›ç¨‹å¼‚å¸¸é€€å‡ºåï¼Œå®ƒä¹Ÿä¼šè‡ªåŠ¨é€€å‡ºï¼Œä»£ç å®ç°å¯è§ reap_zombies å‡½æ•°</li>
</ol>
<h2>å¤ç°ä¸å®šæ¡ˆ</h2>
<p>å½“æˆ‘ä»¬å­¦åˆ°æ ¸å¿ƒçš„æ”¶å°¸æŠ€æœ¯åï¼Œå°±å¯ä»¥æ¥æ­å‘å®Œæ•´çš„æ¡ˆå‘ç°åœºäº† ~</p>
<p><img src="https://user-images.githubusercontent.com/23253540/147583717-1f7591fa-e1fd-4a22-bf36-16792de6df31.png" alt="image"></p>
<h3>1. Docker è¿è¡Œ node xxx.js</h3>
<pre class="prettyprint language-bash"><code>âœ  ~ docker run -t -i -v &#x2F;test&#x2F;tini:&#x2F;test 97f7595bf6c4 node &#x2F;test&#x2F;main.js
</code></pre><p>Tini æ˜¯ä¸€ä¸ª C ç¨‹åºï¼Œè¿™é‡Œå…ˆæŠŠ Tini æ ¸å¿ƒå®ç°çš„ä»£ç å¤åˆ¶è¿‡æ¥ï¼Œæ¥ç€ç”¨ Node.js C++ æ’ä»¶çš„æ–¹å¼æ¥è°ƒç”¨ C è¿™éƒ¨åˆ†çš„ä»£ç </p>
<p>æˆ‘ä»¬çš„ main.js ç¨‹åºå¯¹å¤–æš´éœ²äº†ä¸¤ä¸ªæ¥å£ï¼Œæ¥å®Œæˆæœ¬æ¬¡å®éªŒ</p>
<ul>
<li>/make_zombie: è°ƒç”¨ make_zombie å‡½æ•°äº§ç”Ÿä¸€ä¸ªåƒµå°¸è¿›ç¨‹</li>
<li>/kill_zombie: è°ƒç”¨ kill_zombie å‡½æ•°æ”¶æ‰ä¸€ä¸ªåƒµå°¸è¿›ç¨‹</li>
</ul>
<pre class="prettyprint language-js"><code>&#x2F;&#x2F; &#x2F;test&#x2F;mian.js

const http = require(&quot;http&quot;);
const { exec } = require(&quot;child_process&quot;);
const tini = require(&quot;.&#x2F;build&#x2F;Release&#x2F;addon.node&quot;);

const server = http.createServer((req, res) =&gt; {
  if (req.url === &quot;&#x2F;make_zombie&quot;) {
    console.log(&quot;make_zombie &gt;&gt;&gt;&quot;);
    exec(&quot;node &#x2F;test&#x2F;make_zombie.js&quot;, () =&gt; {});
    res.end(&quot;hello&quot;);
  } else if (req.url === &quot;&#x2F;kill_zombie&quot;) {
    console.log(&quot;kill_zombie &gt;&gt;&gt;&quot;);
    console.log(tini.kill_zombie());
    res.end(&quot;hello&quot;);
  }
});

server.listen(3000);
</code></pre><h3>2. Node ç¨‹åºçš„ PID ä¼šæ˜¯ 1</h3>
<p>âœ… å¯è§ Node æˆä¸ºäº† PID ä¸º 1 çš„è¿›ç¨‹</p>
<pre class="prettyprint language-bash"><code>âœ  ~ docker exec -it 83a67a46ec13 &#x2F;bin&#x2F;bash
[root@83a67a46ec13 &#x2F;]# ps -ef
UID        PID  PPID  C STIME TTY          TIME CMD
root         1     0  0 16:53 pts&#x2F;0    00:00:00 node &#x2F;test&#x2F;main.js
root        14     0  1 16:53 pts&#x2F;1    00:00:00 &#x2F;bin&#x2F;bash
root        28    14  0 16:53 pts&#x2F;1    00:00:00 ps -ef
[root@83a67a46ec13 &#x2F;]#
</code></pre><h3>3. åˆ¶é€ ä¸€ä¸ªåƒµå°¸</h3>
<p>âœ… å­è¿›ç¨‹è°ƒç”¨ exit é€€å‡ºï¼Œçˆ¶è¿›ç¨‹ä¸æ”¶å°¸ï¼Œä½¿å…¶é¡ºåˆ©æˆä¸ºä¸€å…·åƒµå°¸</p>
<pre class="prettyprint language-bash"><code>[root@83a67a46ec13 &#x2F;]# curl localhost:3000&#x2F;make_zombie
hello[root@83a67a46ec13 &#x2F;]# ps -ef
UID        PID  PPID  C STIME TTY          TIME CMD
root         1     0  0 16:53 pts&#x2F;0    00:00:00 node &#x2F;test&#x2F;main.js
root        14     0  0 16:53 pts&#x2F;1    00:00:00 &#x2F;bin&#x2F;bash
root        31     1  0 16:55 pts&#x2F;0    00:00:00 node &#x2F;test&#x2F;make_zom
root        38    31  0 16:55 pts&#x2F;0    00:00:00 [node] &lt;defunct&gt;
root        39    14  0 16:55 pts&#x2F;1    00:00:00 ps -ef
[root@83a67a46ec13 &#x2F;]#
</code></pre><p>äº§ç”Ÿåƒµå°¸çš„ä»£ç ä¸º</p>
<pre class="prettyprint language-c"><code>napi_value make_zombie(napi_env env, napi_callback_info info)
{
    printf(&quot;pid %d\n&quot;, getpid());
    int child_pid = fork();
    if (child_pid == 0)
    {
        printf(&quot;-----in child process:  %d\n&quot;, getpid());
        exit(0);
    }
    else
    {
        sleep(1000000);
    }
    return NULL;
}
</code></pre><p>âœ… æ€æ­»åƒµå°¸è¿›ç¨‹çš„çˆ¶è¿›ç¨‹ï¼Œå®ƒå°±è¢« PID ä¸º 1 çš„è¿›ç¨‹æ‰˜ç®¡</p>
<pre class="prettyprint language-bash"><code>[root@83a67a46ec13 &#x2F;]# kill -9 31
[root@83a67a46ec13 &#x2F;]# ps -ef
UID        PID  PPID  C STIME TTY          TIME CMD
root         1     0  0 16:57 pts&#x2F;0    00:00:00 node &#x2F;test&#x2F;main.js
root        14     0  0 16:57 pts&#x2F;1    00:00:00 &#x2F;bin&#x2F;bash
root        38     1  0 16:59 pts&#x2F;0    00:00:00 [node] &lt;defunct&gt;
root        40    14  0 17:07 pts&#x2F;1    00:00:00 ps -ef
[root@83a67a46ec13 &#x2F;]#
</code></pre><h3>4. æ”¶å°¸</h3>
<p>âœ…  kill -9 æ€ä¸æ­»åƒµå°¸è¿›ç¨‹, ç¬¦åˆé¢„æœŸ</p>
<pre class="prettyprint language-bash"><code>[root@83a67a46ec13 &#x2F;]# kill -9 38
[root@83a67a46ec13 &#x2F;]# ps -ef
UID        PID  PPID  C STIME TTY          TIME CMD
root         1     0  0 16:57 pts&#x2F;0    00:00:00 node &#x2F;test&#x2F;main.js
root        14     0  0 16:57 pts&#x2F;1    00:00:00 &#x2F;bin&#x2F;bash
root        38     1  0 16:59 pts&#x2F;0    00:00:00 [node] &lt;defunct&gt;
root        41    14  0 17:09 pts&#x2F;1    00:00:00 ps -ef
</code></pre><p>âœ… ä½¿ç”¨ waitpid å‡½æ•°å»æ”¶å°¸ï¼Œåƒµå°¸è¿›ç¨‹æ¶ˆå¤±</p>
<pre class="prettyprint language-bash"><code>[root@83a67a46ec13 &#x2F;]# curl localhost:3000&#x2F;kill_zombie
hello[root@83a67a46ec13ps -ef
UID        PID  PPID  C STIME TTY          TIME CMD
root         1     0  0 16:57 pts&#x2F;0    00:00:00 node &#x2F;test&#x2F;main.js
root        14     0  0 16:57 pts&#x2F;1    00:00:00 &#x2F;bin&#x2F;bash
root        44    14  0 17:10 pts&#x2F;1    00:00:00 ps -ef
</code></pre><p>çœŸæ­£æ”¶å°¸çš„ä»£ç ä¸ºä¸‹é¢ï¼Œå¹¶ä¸”é€šè¿‡ Node-api æŠŠæœ¬æ¬¡æ”¶å°¸è¿›ç¨‹çš„ id å’Œ status è¿”å›ç»™äº† js è°ƒç”¨æ–¹ã€‚</p>
<pre class="prettyprint language-c"><code>napi_value kill_zombie(napi_env env, napi_callback_info info)
{
    int current_pid;
    int current_status;
    napi_status status;

    current_pid = waitpid(-1, &amp;current_status, WNOHANG);
    napi_value n_pid;
    napi_value n_status;
    status = napi_create_int32(env, current_pid, &amp;n_pid);
    assert(status == napi_ok);

    status = napi_create_int32(env, current_status, &amp;n_status);
    assert(status == napi_ok);

    napi_value obj;
    status = napi_create_object(env, &amp;obj);
    assert(status == napi_ok);

    status = napi_set_named_property(env, obj, &quot;pid&quot;, n_pid);
    assert(status == napi_ok);

    status = napi_set_named_property(env, obj, &quot;status&quot;, n_status);
    assert(status == napi_ok);

    return obj;
}
</code></pre><p>å¯è§é€šè¿‡æˆ‘ä»¬é€æ­¥çš„å¤ç›˜ï¼Œä¸€åˆ‡ä¹Ÿéƒ½éªŒè¯äº†æˆ‘ä»¬æœ€åˆçš„çŒœæƒ³ã€‚</p>
<h2>å°ç»“</h2>
<p>å…¶å®åƒµå°¸è¿›ç¨‹çš„äº§ç”Ÿä¹Ÿæ˜¯ puppeteer ç¨‹åºçš„ä¸€ä¸ª bug, Node.js ä¸å»å¤„ç†ä¹Ÿæ˜¯æƒ…ç†ä¹‹ä¸­ï¼Œå› ä¸ºå¾ˆéš¾åˆ¤æ–­ç”¨æˆ·çœŸæ­£çš„è¡Œä¸ºï¼Œå†µä¸”è¿˜è¦å†™ä¸€å †å‰¯ä½œç”¨çš„ä»£ç ã€‚</p>
<p>æœ€åæˆ‘ä»¬é€šè¿‡ docker --init ä½¿ç”¨ä¸€ä¸ª init è¿›ç¨‹å»è§£å†³ï¼Œè¿™æ ·è¿›ç¨‹é—´äº’ç›¸è§£è—•ï¼Œå„å¸å…¶èŒæ˜¾å¾—ä¼˜é›…ä¸€ç‚¹ã€‚è¿™ä¹Ÿç®—è·µè¡Œäº†sidecar æ¨¡å¼å§ ~</p>
</div>